Sub CopyandFormat()Dim intBB As IntegerDim rngBB As RangeDim intBB2 As IntegerDim rngBB2 As RangeDim LastRow As LongDim SUM As LongDim last_row As LongDim LastCol As IntegerDim dk As StringDim rng As RangeDim zero As LongDim control0 As StringDim ISINcheck As StringDim WKNcheck As StringDim i As IntegerDim intValueToFind As StringDim controlISIN As StringDim controlWKN As String    dk = "Blockordernummer"    If Trim(dk) <> "" Then        With Sheets(1).Range("1:1000")            Set rng = .Find(dk, .Cells(.Cells.Count), xlValues, xlWhole, xlByRows, xlNext, _            False)            Application.Goto rng, True        End With    End IfWith ActiveWorkbook.Sheets(1)    last_row = .Range("B" & .Rows.Count).End(xlUp).RowEnd WithDebug.Print last_rowWith ActiveWorkbook.Sheets(1)        LastCol = .Cells(rng.Row, .Columns.Count).End(xlToLeft).ColumnEnd With        Cells.Find(What:="Blockordernummer", After:=ActiveCell, LookIn:= _        xlFormulas, LookAt:=xlWhole, SearchOrder:=xlByRows, SearchDirection:= _        xlNext, MatchCase:=False, SearchFormat:=False).Activate    Range(Selection, Selection.End(xlToRight)).Select    Range(Selection, Cells(last_row, LastCol)).Select    Selection.Copy    Workbooks.Add    ActiveSheet.PasteintBB2 = 1Do While ActiveWorkbook.Sheets(1).Cells(1, intBB2) <> ""        If ActiveWorkbook.Sheets(1).Cells(1, intBB2).Value = "ISIN" Then            With ActiveWorkbook.Sheets(1)                Set rngBB2 = .Range(.Cells(1, intBB2), .Cells(1, intBB2))                             End With         Exit Do        End If          intBB2 = intBB2 + 1    Loop    LastRow = ActiveWorkbook.Sheets(1).Cells(Sheets(1).Rows.Count, intBB2).End(xlUp).RowintValueToFind = Cells(2, intBB2).ValueFor i = 2 To LastRow    If Not Cells(i, intBB2).Value = intValueToFind Then        ISINcheck = i    End IfNext iIf ISINcheck = "" Then    controlISIN = "Nein"Else    controlISIN = "Ja"End IfintBB = 1Do While ActiveWorkbook.Sheets(1).Cells(1, intBB) <> ""        If ActiveWorkbook.Sheets(1).Cells(1, intBB).Value = "AWKN" Then            With ActiveWorkbook.Sheets(1)                Set rngBB = .Range(.Cells(1, intBB), .Cells(1, intBB))             End With         Exit Do        End If          intBB = intBB + 1    LoopintValueToFind = Cells(2, intBB).ValueFor i = 2 To LastRow    If Not Cells(i, intBB).Value = intValueToFind Then        WKNcheck = i    End IfNext iIf WKNcheck = "" Then    controlWKN = "Nein"Else    controlWKN = "Ja"End IfintBB = 1Do While ActiveWorkbook.Sheets(1).Cells(1, intBB) <> ""        If ActiveWorkbook.Sheets(1).Cells(1, intBB).Value = "Gültig bis" Then            With ActiveWorkbook.Sheets(1)                Set rngBB = .Range(.Cells(1, intBB), .Cells(1, intBB))             End With         Exit Do        End If          intBB = intBB + 1    LoopRange(Cells(2, intBB), Cells(LastRow, intBB)).NumberFormat = "ddmmyy"intBB = 1Do While ActiveWorkbook.Sheets(1).Cells(1, intBB) <> ""        If ActiveWorkbook.Sheets(1).Cells(1, intBB).Value = "Stck/Nom" Then            With ActiveWorkbook.Sheets(1)                Set rngBB = .Range(.Cells(1, intBB), .Cells(1, intBB))             End With         Exit Do        End If          intBB = intBB + 1    Loop    zero = WorksheetFunction.CountIf(Range(Cells(2, intBB), Cells(LastRow, intBB)), 0)   If zero = 0 Then    control0 = "Nein"Else   control0 = "Ja"End If   SUM = Application.SUM(Range(Cells(2, intBB), Cells(LastRow, intBB)))MsgBox "Anzahl von Orders: " & LastRow - 1 & _vbNewLine & "Summe der Stücke: " & SUM & _vbNewLine & "Null: " & control0 & _vbNewLine & "Unterschiedliche ISINs/WKNs: " & controlISIN & " / " & controlWKN    End Sub
